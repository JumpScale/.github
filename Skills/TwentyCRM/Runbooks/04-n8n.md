# Stap 4: n8n installeren (optioneel)

## Doel
n8n workflow automation draaiend naast Twenty CRM voor automatiseringen.

---

## 4.1 DNS record aanmaken [Jij moet dit doen]

```
Maak een A-record aan bij je DNS-provider:
  n8n.<jouwdomein> -> <SERVER_IP>

Voorbeeld: n8n.jumpscale.nl -> 46.225.6.59
```

## 4.2 Docker Compose [Claude doet dit]

```bash
cat > /opt/n8n/docker-compose.yml << 'EOF'
name: n8n

services:
  n8n:
    image: n8nio/n8n:latest
    ports:
      - "127.0.0.1:5678:5678"
    volumes:
      - n8n-data:/home/node/.n8n
    environment:
      N8N_HOST: n8n.<DOMEIN>
      N8N_PORT: 5678
      N8N_PROTOCOL: https
      WEBHOOK_URL: https://n8n.<DOMEIN>/
      N8N_SECURE_COOKIE: "true"
      GENERIC_TIMEZONE: Europe/Amsterdam
      TZ: Europe/Amsterdam
    restart: always

volumes:
  n8n-data:
EOF
```

## 4.3 Opstarten [Claude doet dit]

```bash
cd /opt/n8n && docker compose up -d
```

## 4.4 Reverse proxy voor n8n [Claude doet dit]

### nginx

```bash
cat > /etc/nginx/sites-available/n8n << 'EOF'
server {
    listen 80;
    server_name n8n.<DOMEIN>;

    client_max_body_size 64M;

    location / {
        proxy_pass http://127.0.0.1:5678;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_buffering off;
        proxy_request_buffering off;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}
EOF

ln -sf /etc/nginx/sites-available/n8n /etc/nginx/sites-enabled/
nginx -t && systemctl reload nginx
certbot --nginx -d n8n.<DOMEIN> --non-interactive --agree-tos -m <EMAIL>
```

## 4.5 Owner account [Jij moet dit doen]

```
n8n draait. Ga naar https://n8n.<DOMEIN> in je browser.
Maak je eerste account aan -- dit wordt de owner.
```

## 4.6 Workflows migreren (optioneel)

Als je bestaande workflows hebt in n8n cloud:

1. Exporteer workflows via cloud API of handmatig (Settings > Export)
2. Kopieer JSON bestanden naar de server
3. Importeer via CLI:
   ```bash
   docker cp /opt/n8n/import n8n-n8n-1:/tmp/import
   docker exec n8n-n8n-1 n8n import:workflow --separate --input=/tmp/import/
   ```

**Let op:** Credentials worden niet mee-geexporteerd (encrypted). Die moet je opnieuw instellen in de UI.

---

## Verificatie

```bash
docker compose -f /opt/n8n/docker-compose.yml ps   # Container "Up"
curl -s -o /dev/null -w "%{http_code}" https://n8n.<DOMEIN>  # 200
```
